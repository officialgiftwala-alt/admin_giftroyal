<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="loader.css">
<div class="layout">
  <aside id="sidebar" class="sidebar"></aside>
  <main class="main">
    <header class="topbar">
      <button id="menuToggle" class="menu-btn" aria-label="Open menu">
        <svg width="24" height="24" viewBox="0 0 24 24"><path d="M3 6h18M3 12h18M3 18h18" fill="none" stroke="currentColor" stroke-width="2"/></svg>
      </button>
      <h1>Slider</h1>
    </header>
    <div class="content">
      <div id="loader" style="display:none">Loading...</div>
      <form id="sliderForm" class="card form-grid">
        <label>
          <span>Image</span>
          <input type="file" id="image" accept="image/*">
        </label>
        <label>
          <span>Title</span>
          <input type="text" id="title" placeholder="Enter Title">
        </label>
        <label>
          <span>Button Text</span>
          <input type="text" id="btntext" placeholder="Enter Button Text">
        </label>
        <label>
          <span>URL</span>
          <input type="text" id="url" placeholder="Enter URL">
        </label>
        <button type="submit" class="btn">Submit</button>
      </form>
      <div id="sliderList" class="grid"></div>
      <div id="alertBox" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);align-items:center;justify-content:center">
        <div class="card" style="max-width:340px;text-align:center">
          <p>Do you really want to delete?</p>
          <div class="actions">
            <button id="yesBtn" class="btn danger" type="button">Yes</button>
            <button id="noBtn" class="btn ghost" type="button">No</button>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script src="sidebar.js"></script>
<script>
const DEPLOY_URL="https://script.google.com/macros/s/AKfycbxkUJpgVnZd-Yvp9ElujJOXNcbfuMyDBKdEpYWmNOxcJc13hzzSo9NEB4s9p3N0JRtLEQ/exec";
const API_KEY="5ee8338b80aa6e72c63fdba3755f9f52";
let deleteId=null;
function showLoader(x){document.getElementById("loader").style.display=x?"block":"none"}
async function postJSON(url,data){
  try{
    return await fetch(url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)});
  }catch(e){
    return fetch(url,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)});
  }
}
function loadSliders(){
  document.getElementById("sliderList").innerHTML="";
  fetch(DEPLOY_URL+"?type=sliderlist&t="+Date.now()).then(r=>r.json()).then(data=>{
    data.forEach(s=>{
      let card=document.createElement("div");card.className="card row";
      let img=document.createElement("img");img.src=s.image;img.alt=s.title;img.className="thumb";
      let info=document.createElement("div");info.className="row-main";
      let title=document.createElement("div");title.className="title";title.textContent=s.title;
      let actions=document.createElement("div");actions.className="actions";
      let link=document.createElement("a");link.href=s.url;link.target="_blank";link.className="btn ghost";link.textContent="Open";
      let btn=document.createElement("button");btn.type="button";btn.className="btn danger";btn.textContent="Delete";
      btn.onclick=()=>{deleteId=s.id;document.getElementById("alertBox").style.display="flex"};
      info.appendChild(title);actions.appendChild(link);actions.appendChild(btn);
      card.appendChild(img);card.appendChild(info);card.appendChild(actions);
      document.getElementById("sliderList").appendChild(card);
    });
  });
}
document.getElementById("sliderForm").addEventListener("submit",async e=>{
  e.preventDefault();
  showLoader(true);
  const file=document.getElementById("image").files[0];
  const title=document.getElementById("title").value.trim();
  const btntext=document.getElementById("btntext").value.trim();
  const url=document.getElementById("url").value.trim();
  let imageUrl="";
  if(file){
    const fd=new FormData();fd.append("image",file);
    const up=await fetch("https://api.imgbb.com/1/upload?key="+API_KEY,{method:"POST",body:fd});
    const res=await up.json();imageUrl=res?.data?.url||"";
  }
  await postJSON(DEPLOY_URL,{image:imageUrl,title,btntext,url,action:"addslider"});
  showLoader(false);
  loadSliders();
  e.currentTarget.reset();
});
document.getElementById("yesBtn").onclick=async ()=>{
  await postJSON(DEPLOY_URL,{id:deleteId,action:"deleteslider"});
  document.getElementById("alertBox").style.display="none";
  loadSliders();
};
document.getElementById("noBtn").onclick=()=>{document.getElementById("alertBox").style.display="none"};
loadSliders();
</script>
